     1→# frozen_string_literal: true
     2→
     3→# == Schema Information
     4→#
     5→# Table name: wait_list_outreach_attempts
     6→#
     7→#  id                 :uuid             not null, primary key
     8→#  expires_at         :datetime
     9→#  initiated_at       :datetime
    10→#  mode               :string           default("email"), not null
    11→#  staffer_ids        :string           default([]), is an Array
    12→#  created_at         :datetime         not null
    13→#  updated_at         :datetime         not null
    14→#  wait_list_entry_id :uuid
    15→#
    16→# Indexes
    17→#
    18→#  index_wait_list_outreach_attempts_on_wait_list_entry_id  (wait_list_entry_id)
    19→#
    20→# Foreign Keys
    21→#
    22→#  fk_rails_...  (wait_list_entry_id => wait_list_entries.id)
    23→#
    24→module WaitList
    25→  class OutreachAttempt < ApplicationRecord
    26→    Mode = Enum.new(%w[email phone_call])
    27→
    28→    belongs_to :entry, class_name: "WaitList::Entry", foreign_key: "wait_list_entry_id"
    29→    has_many :events, class_name: "WaitList::OutreachAttempt::Event", foreign_key: "wait_list_outreach_attempt_id", dependent: :destroy
    30→
    31→    enum :mode, Mode.as_string_map
    32→
    33→    scope :for_care_case, ->(care_case) { joins(entry: :care_case).where(wait_list_entries: {care_case_id: care_case.id}) }
    34→    scope :active, -> { where("coalesce(expires_at > ?, true)", Time.zone.now) }
    35→    scope :most_recent, -> { order(initiated_at: :desc) }
    36→
    37→    TTL = 48.hours # Time to live
    38→
    39→    def staffers
    40→      Staffer.where(id: staffer_ids)
    41→    end
    42→
    43→    def expired?
    44→      return false unless expires_at.present?
    45→      expires_at <= Time.zone.now
    46→    end
    47→  end
    48→end
    49→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
