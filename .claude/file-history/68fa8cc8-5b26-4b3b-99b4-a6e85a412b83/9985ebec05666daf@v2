# frozen_string_literal: true

module Staffers
  module Accounts
    class AccountLinksComponent < ViewComponent::Base
      attr_reader :staffer, :account, :member

      def initialize(staffer:, account:, member:)
        @staffer = staffer
        @account = account
        @member = member
      end

      def chat_channels
        @_chat_channels ||= Chat::AccessibleStafferChannel
          .for(account:, staffer:, member:)
          .map do |channel|
          {
            channel:,
            tooltip: Chat::ChannelLastMessage.for(accessible_staffer_channel: channel),
            path: account_member_chat_path(account, member, channel.sendbird_chat_channel, sendbird_user_id: channel.sendbird_user, secondary_tab: channel.parameterized_name)
          }
        end
      end
    end
  end
end
