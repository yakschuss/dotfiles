# frozen_string_literal: true

module SlotRecapture
  class ExpireOpportunitiesJob < ApplicationJob
    sidekiq_options queue: :low, retry: 2

    def perform
      return unless Flipper.enabled?(:slot_recapture_enabled)

      Opportunity
        .actionable
        .where(start_time: ...Time.current)
        .find_each(&:expired!)
    end
  end
end
