# frozen_string_literal: true

module SlotRecapture
  class Match
    attr_reader :entry, :opportunity, :score, :breakdown

    def initialize(entry:, opportunity:, score:, breakdown:)
      @entry = entry
      @opportunity = opportunity
      @score = score
      @breakdown = breakdown
    end

    def same_provider?
      breakdown[:same_provider] > 0
    end

    def clinic_match?
      breakdown[:clinic_match] > 0
    end

    def quality
      return :strong if score >= 0.7
      return :partial if score >= 0.4
      :weak
    end

    # Delegate to entry for convenience
    def care_case
      entry.care_case
    end

    def patient
      care_case.patient
    end

    def caregivers
      care_case.caregivers
    end

    def contact_email
      care_case.account.owner&.email || patient&.email
    end

    def contact_phone
      care_case.account.owner&.phone || patient&.phone
    end
  end
end
