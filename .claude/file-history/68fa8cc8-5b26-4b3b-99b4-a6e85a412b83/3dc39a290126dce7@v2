# frozen_string_literal: true

module Staffers
  class ReminderChatLinksComponent < ViewComponent::Base
    attr_reader :reminder, :staffer, :account

    def initialize(reminder:, staffer:)
      @reminder = reminder
      @account = reminder.account
      @staffer = staffer
    end

    private

    def accessible_staffer_channels
      all_channels = Chat::AccessibleStafferChannel.for_all_members_scoped_to_staffer(account: account, staffer: staffer)

      if reminder.care_case_id.present?
        care_case_channels = all_channels.select { |channel| channel.sendbird_chat_channel.care_case_id == reminder.care_case_id }
        care_case_channels.any? ? care_case_channels : all_channels
      else
        all_channels
      end
    end
  end
end
