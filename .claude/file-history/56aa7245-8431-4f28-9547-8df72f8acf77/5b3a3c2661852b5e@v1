# frozen_string_literal: true

# == Schema Information
#
# Table name: slot_recapture_opportunities
#
#  id                       :uuid             not null, primary key
#  lead_time_hours          :integer          not null
#  modality                 :string
#  slot_verified_at         :datetime
#  start_time               :datetime         not null
#  status                   :string           default("pending_verification"), not null
#  created_at               :datetime         not null
#  updated_at               :datetime         not null
#  appointment_type_id      :string           not null
#  cancelled_appointment_id :uuid             not null
#  clinic_id                :uuid             not null
#  region_id                :string           not null
#  root_appointment_type_id :string           not null
#  staffer_id               :uuid             not null
#
# Indexes
#
#  index_slot_recapture_opportunities_on_cancelled_appointment_id  (cancelled_appointment_id) UNIQUE
#  index_slot_recapture_opportunities_on_clinic_id                 (clinic_id)
#  index_slot_recapture_opportunities_on_staffer_id                (staffer_id)
#  index_slot_recapture_opportunities_on_start_time                (start_time)
#  index_slot_recapture_opportunities_on_status                    (status)
#
# Foreign Keys
#
#  fk_rails_...  (cancelled_appointment_id => appointments.id)
#  fk_rails_...  (clinic_id => clinics.id)
#  fk_rails_...  (staffer_id => staffers.id)
#
FactoryBot.define do
  factory :slot_recapture_opportunity, class: "SlotRecapture::Opportunity" do
    association :cancelled_appointment, factory: [:appointment, :with_care_case, :in_the_future]
    association :staffer
    association :clinic
    appointment_type_id { AppointmentType.therapy_initial_session.id }
    root_appointment_type_id { RootAppointmentType.therapy_initial_session.id }
    region_id { Region.california.id }
    start_time { 48.hours.from_now }
    lead_time_hours { 48 }
    modality { "video" }
    status { "pending_verification" }

    trait :open do
      status { "open" }
      slot_verified_at { Time.current }
    end

    trait :offered do
      status { "offered" }
      slot_verified_at { Time.current }
    end

    trait :filled do
      status { "filled" }
      slot_verified_at { Time.current }
    end

    trait :expired do
      status { "expired" }
    end

    trait :ineligible do
      status { "ineligible" }
    end

    trait :in_person do
      modality { "in_person" }
    end

    trait :virtual do
      modality { "video" }
    end

    trait :phone do
      modality { "phone" }
    end
  end
end
